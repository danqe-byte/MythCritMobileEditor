# Myth Crit Mobile Editor

Простое мобильное Flutter-приложение для мастеров настольных RPG, позволяющее редактировать карты, ставить маркеры и токены, а также экспортировать чистую сцену (без маркеров и UI) для отображения на телевизоре.

## Возможности
- Список проектов с созданием, переименованием и удалением.
- Редактор карт внутри проекта: выбор карты, добавление новых карт из галереи, масштабирование и панорамирование.
- Маркеры с подписью и ссылкой на другую карту (только для мастера).
- Токены с подписью, собственной иконкой и флагом «видно игрокам».
- Перетаскивание токенов и автосохранение проекта.
- Экспорт текущей сцены в PNG (только карта и токены, отмеченные как видимые) с сохранением в галерею.

## Требования
- Flutter SDK (рекомендуется 3.16+).
- Android SDK / эмулятор или подключённое Android-устройство.

## Основные команды
```bash
flutter pub get
flutter run
```
Запускайте на Android-устройстве или эмуляторе.

## Краткое руководство
1. **Проекты**: на главном экране создайте новый проект или откройте существующий. Доступно переименование и удаление проектов.
2. **Карты**: на экране редактора добавьте карту из галереи и выберите её в списке карт сверху.
3. **Маркеры**: включите режим «Добавить маркер», тапните по карте, затем задайте название и целевую карту в открывшемся окне.
4. **Токены**: нажмите «Добавить токен» или тапните по карте (когда маркер-режим выключен). В настройках токена задайте название, иконку (по желанию) и флаг видимости для игроков.
5. **Перетаскивание**: токены можно перемещать перетаскиванием; координаты сохраняются автоматически.
6. **Экспорт сцены**: нажмите кнопку с иконкой ТВ — PNG сохранится в галерею. На изображении только карта и токены, отмеченные как видимые.

## Структура проекта
- `lib/models/` — модели данных проекта, карт, маркеров и токенов.
- `lib/services/` — хранение проектов, работа с изображениями и экспортом сцен.
- `lib/ui/screens/` — основные экраны списка проектов и редактора карты.
- `lib/ui/widgets/` — канвас карты и вспомогательные виджеты.

## Проверка (ручные сценарии)
1. **Базовый проект**: создать проект «Гоблинский лагерь», сразу открыть его, добавить карту из галереи, убедиться, что карта отображается. Закрыть и снова открыть проект — карта на месте.
2. **Маркеры и токены**: включить «Добавить маркер», тапнуть по карте, задать подпись «Пещера» и (опционально) целевую карту. Нажать «Добавить токен», по подсказке тапнуть по карте, задать имя/иконку и флаг видимости. Перетащить токен и убедиться, что после перезапуска приложения он остаётся на новом месте.
3. **Экспорт сцены**: добавить два токена, у одного снять флаг видимости для игроков. Нажать «Экспорт сцены», дождаться снекбара об успешном сохранении. В галерее/папке приложения PNG содержит карту и только видимые для игроков токены, без маркеров и UI.

## Возможные улучшения
- Сетка и привязка к клеткам.
- Экспорт всех карт проекта сразу.
- Поддержка нескольких слоёв токенов и группового выделения.
- История изменений и отмена действий.

### Примечание по сборке Android
В репозитории включён минимальный Android-шаблон. Если Gradle wrapper или platform-файлы окажутся устаревшими в вашей среде, выполните `flutter create .` для их регенерации перед запуском.
